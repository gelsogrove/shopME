# Cursor Rules for AI4Devs Final Project

## ğŸ§  Core Development Rules

 - Address me **by name (Andrea)** in chats and discussions (e.g., "Hello Andrea", "Andrea, what do you think?")
 - contex: @/terraform @/backend @/frontend  @/scripts 
- Focus **only** on code areas **relevant to the assigned task**
- **DO NOT INVENT** anything outside of the assigned scope
- **Keep solutions simple** and avoid unnecessary complexity
- All code and comments must be **in English**
- **NEVER** run `git push` â€” **only Andrea** can do this
- Use **PostgreSQL** (not SQLite)
- **OPENROUTER_API_KEY** is stored in the `.env` file of the backend (DO NOT TOUCH `.env`)
- All **scripts** must be placed inside the `/script` folderÃ§
- If the request is not documenteted on the 02_PRD.md please alert the user

- Maintain the existing **graphics and layout**; DO NOT make changes unless **explicit permission** is granted

## ğŸ”’ CRITICAL BACKUP RULE FOR .ENV FILES

âš ï¸ **MANDATORY BACKUP BEFORE ANY .ENV INTERACTION:**
- **BEFORE** reading, checking, or interacting with ANY `.env` file, **ALWAYS** create a backup first
- **COMMAND TO RUN FIRST:** `cp .env .env.backup.$(date +%Y%m%d_%H%M%S)`
- **NEVER** touch `.env` files without creating a timestamped backup
- **IF .ENV IS LOST:** immediately restore from the most recent `.env.backup.*` file
- **ALWAYS** inform Andrea when creating backups: "Andrea, I'm creating a backup of .env before proceeding"

## ğŸš¨ CRITICAL PDF FILE PROTECTION RULE

âš ï¸ **NEVER DELETE OR MODIFY THE PDF FILE:**
- **NEVER** delete, modify, or touch `backend/prisma/temp/international-transportation-law.pdf`
- **NEVER** remove files from `backend/prisma/temp/` directory
- **NEVER** modify the seed script to remove PDF file creation
- **THIS FILE IS CRITICAL** for the system to work properly
- **IF DELETED:** Andrea will be very angry and the system will break
- **ALWAYS** preserve this file during any script or seed modifications

## ğŸš¨ CRITICAL DATABASE-ONLY CONFIGURATION RULE

âš ï¸ **NEVER CREATE HARDCODED CONFIGURATION FALLBACKS:**
- **NEVER** create hardcoded default prompts, models, or agent configurations
- **NEVER** use fallback values like `DEFAULT_PROMPT` or `initialConfig` in frontend/backend
- **ALL CONFIGURATION MUST COME FROM DATABASE** - no exceptions
- **IF DATABASE CONFIG IS MISSING:** show proper error message to user, don't create fallbacks
- **AGENT PROMPTS:** must always come from `agentConfig` table in database
- **NO STATIC PROMPTS:** everything must be dynamic from database
- **ERROR HANDLING:** if config not found, show error - don't invent default values
- **FRONTEND:** if no config from API, show error state - don't use hardcoded defaults
- **BACKEND:** if no agent config in DB, return error - don't use fallback prompts

## âŒ Strict Prohibitions - What Never to Do

### ğŸš« NEVER HARDCODE DATA

- **NEVER** create hardcoded responses or fallback data in controllers
- **NEVER** return fake/mock data outside of test environments
- **NEVER** use hardcoded product lists, prices, or inventory data
- **NEVER** create static responses that bypass database queries
- **ALWAYS** use dynamic database searches and fetch real data from **Prisma**
- **NO** static text, prompts, or codes; **everything must come from the database**

### ğŸš« Additional Restrictions

- DO NOT write any **catch blocks** with generic messages; **always provide the full error stack**
- **NEVER create fake functions** â€“ everything must reflect the real database and logic
- **NEVER change the layout or graphics** without my **explicit permission**
- **Update ONLY existing tasks** in the task list when completing work - **DO NOT add new tasks**

## ğŸš« Critical Restrictions

- **NEVER** use hardcoded conditions like `lowerQuery.includes('vino') || lowerQuery.includes('export')`
- **DO NOT USE OPENAI** - use **OPENROUTER** instead
- **NEVER** use the word "hardcode" in the backend code
- **NEVER** use the a static prompt the promtp hast to arrive from the database agent settings along with temperature, topP, token,model

## ğŸ“š Architecture Notes

### LLM Workflow
The user's input is processed through a two-stage LLM workflow:
1. **First LLM**: Decides the target calling function
2. **Second LLM**: Has history and formats the final user response

> **Note**: This is the **only static point** in the workflow. If the flow **does not follow** this structure, we must discuss it or **modify the agent's prompt** inside the **SEED**.

### Project Structure
- Don't create `package.json` in root - use `backend` or `frontend` folders for installing packages
- **DON'T CREATE any files IN ROOT** - use `temp` or use `/prompts` if needed

## ğŸ“‹ Task Management

- Always update **ONLY the existing tasks** in `prompts/04_task-list.md` when completing tasks that are already present on the list
- **DO NOT add new tasks** to the task list - only mark existing ones as completed or update their status
- Keep track of progress and document changes properly
- Get always the full context from @backend @frontend and @final
- Get the context from the test unit, integration, integration for having a better understanding 
- Keep swagger configuration always updated

## ğŸ“š Documentation References

All project documentation is located under:
- **Task List**: `prompts/04_task-list.md`
- **PRD Document**: `prompts/docs/PRD.md`
- **LangChain Documentation**: `prompts/docs/langchain.md`
- **MetaPrompt**: `prompts/docs/metaprompt.md`
- **OWASP Security**: `prompts/docs/owasp.md`
- **Agent Prompt**: `prompts/docs/prompt_agent.md`
- IF YOU WANT TO SEE WHAT WE HAVE IN THE DB USE FOR EXAMPLES:
docker exec -it shopmefy-db psql -U shopmefy -d shopmefy -c "SELECT COUNT(*) FROM document_chunks;"
- **DO NOT invent npm run commands!** 
- mocks have to stay inside  __mocks__ folder inside unit or integration folder
AI4Devs-finalproject/backend/__tests__/unit/mock
AI4Devs-finalproject/backend/__tests__/integration/mock

## ğŸ“ Folder Structure Compliance

- **ALWAYS** follow the folder structure defined below
- **NEVER** create files outside the defined directory structure
- **Test files** must be in `__tests__/` (backend) or `__test__/` (frontend) directories
- **Mocks** must be in `__mocks__/` subdirectories within test folders
- **Scripts** must be in `/scripts/` directory and be executable
- **Configuration files** must be at the appropriate level (backend/frontend)
- Use **kebab-case** for directories, **camelCase** for TypeScript files, **PascalCase** for React components

### ğŸ—ï¸ Root Project Structure
```
AI4Devs-finalproject/
â”œâ”€â”€ ğŸ“ backend/                     # Backend Node.js application
â”œâ”€â”€ ğŸ“ frontend/                    # Frontend React application  
â”œâ”€â”€ ğŸ“ scripts/                     # Project automation scripts
â”œâ”€â”€ ğŸ“ prompts/                     # Documentation and prompts
â”œâ”€â”€ ğŸ“„ docker-compose.yml           # Docker services configuration
â”œâ”€â”€ ğŸ“„ .gitignore                   # Git ignore rules
â””â”€â”€ ğŸ“„ README.md                    # Project overview
```

### ğŸ”§ Backend Structure (`/backend/`)
```
backend/
â”œâ”€â”€ ğŸ“ src/                         # Source code
â”‚   â”œâ”€â”€ ğŸ“ controllers/             # API controllers (DDD Application Layer)
â”‚   â”œâ”€â”€ ğŸ“ services/                # Business logic services (DDD Domain Layer)
â”‚   â”œâ”€â”€ ğŸ“ repositories/            # Data access layer (DDD Infrastructure)
â”‚   â”œâ”€â”€ ğŸ“ middleware/              # Express middleware
â”‚   â”œâ”€â”€ ğŸ“ routes/                  # API route definitions
â”‚   â”œâ”€â”€ ğŸ“ types/                   # TypeScript type definitions
â”‚   â”œâ”€â”€ ğŸ“ utils/                   # Utility functions
â”‚   â””â”€â”€ ğŸ“„ index.ts                 # Application entry point
â”œâ”€â”€ ğŸ“ prisma/                      # Database schema and migrations
â”‚   â”œâ”€â”€ ğŸ“ migrations/              # Database migration files
â”‚   â”œâ”€â”€ ğŸ“ temp/                    # Temporary files for seeding
â”‚   â”œâ”€â”€ ğŸ“„ schema.prisma            # Database schema definition
â”‚   â””â”€â”€ ğŸ“„ seed.ts                  # Database seeding script
â”œâ”€â”€ ğŸ“ uploads/                     # File upload storage
â”‚   â””â”€â”€ ğŸ“ documents/               # Document storage directory
â”œâ”€â”€ ğŸ“ __tests__/                   # Test files (MANDATORY structure)
â”‚   â”œâ”€â”€ ğŸ“ unit/                    # Unit tests
â”‚   â”‚   â”œâ”€â”€ ğŸ“ __mocks__/           # Unit test mocks
â”‚   â”‚   â””â”€â”€ ğŸ“„ *.spec.ts            # Unit test files
â”‚   â””â”€â”€ ğŸ“ integration/             # Integration tests
â”‚       â”œâ”€â”€ ğŸ“ __mocks__/           # Integration test mocks
â”‚       â””â”€â”€ ğŸ“„ *.integration.spec.ts # Integration test files
â”œâ”€â”€ ğŸ“„ package.json                 # Dependencies and scripts
â”œâ”€â”€ ğŸ“„ jest.config.js               # Jest testing configuration
â”œâ”€â”€ ğŸ“„ tsconfig.json                # TypeScript configuration
â””â”€â”€ ğŸ“„ .env                         # Environment variables (DO NOT COMMIT)
```

### âš›ï¸ Frontend Structure (`/frontend/`)
```
frontend/
â”œâ”€â”€ ğŸ“ src/                         # Source code
â”‚   â”œâ”€â”€ ğŸ“ components/              # React components
â”‚   â”‚   â”œâ”€â”€ ğŸ“ ui/                  # Reusable UI components (shadcn/ui)
â”‚   â”‚   â””â”€â”€ ğŸ“ layout/              # Layout components
â”‚   â”œâ”€â”€ ğŸ“ pages/                   # Page components
â”‚   â”œâ”€â”€ ğŸ“ hooks/                   # Custom React hooks
â”‚   â”œâ”€â”€ ğŸ“ services/                # API service functions
â”‚   â”œâ”€â”€ ğŸ“ types/                   # TypeScript type definitions
â”‚   â”œâ”€â”€ ğŸ“ utils/                   # Utility functions
â”‚   â”œâ”€â”€ ğŸ“ styles/                  # CSS and styling files
â”‚   â””â”€â”€ ğŸ“„ main.tsx                 # Application entry point
â”œâ”€â”€ ğŸ“ public/                      # Static assets
â”œâ”€â”€ ğŸ“ __test__/                    # Test files (MANDATORY structure)
â”‚   â”œâ”€â”€ ğŸ“ unit/                    # Unit tests
â”‚   â”‚   â””â”€â”€ ğŸ“„ *.{test,spec}.{js,ts,tsx} # Unit test files
â”‚   â””â”€â”€ ğŸ“ e2e/                     # End-to-end tests
â”‚       â”œâ”€â”€ ğŸ“ support/             # Cypress support files
â”‚       â”‚   â”œâ”€â”€ ğŸ“„ commands.js      # Custom Cypress commands
â”‚       â”‚   â””â”€â”€ ğŸ“„ e2e.js           # Cypress setup file
â”‚       â””â”€â”€ ğŸ“„ *.cy.{js,ts,tsx}     # E2E test files
â”œâ”€â”€ ğŸ“„ package.json                 # Dependencies and scripts
â”œâ”€â”€ ğŸ“„ vite.config.ts               # Vite configuration
â”œâ”€â”€ ğŸ“„ vitest.config.ts             # Vitest testing configuration
â”œâ”€â”€ ğŸ“„ cypress.config.cjs           # Cypress E2E testing configuration
â”œâ”€â”€ ğŸ“„ tailwind.config.js           # Tailwind CSS configuration
â””â”€â”€ ğŸ“„ tsconfig.json                # TypeScript configuration
```

### ğŸš« Forbidden Patterns
**DO NOT CREATE:**
- `package.json` in project root
- Test files outside `__tests__/` or `__test__/` directories
- `cypress/` directory in frontend (use `__test__/e2e/` instead)
- Files directly in `src/` without proper subdirectories
- Mixed naming conventions

### âœ… Mandatory Naming Rules
- **Directories**: kebab-case (`document-service`, `user-controller`)
- **TypeScript files**: camelCase (`userService.ts`, `documentController.ts`)
- **React components**: PascalCase (`UserProfile.tsx`, `DocumentList.tsx`)
- **Test files**: `*.spec.ts` (unit), `*.integration.spec.ts` (integration), `*.cy.js` (E2E)
- system has to be sync , swagger, seed code, test BE FE Readme prompts folder when you finish a job ask me do you need to update this section too ? 
- when i say PRD you have to consider this file `/prompts/02_PRD.md`
